<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¶Ø§Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡ - Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .season-info {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            color: white;
        }

        .import-section {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
        }

        .import-section h3 {
            margin-bottom: 15px;
            text-align: center;
        }

        .import-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-button {
            display: inline-block;
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px dashed rgba(255,255,255,0.5);
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .file-input-button:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.8);
        }

        .url-input {
            padding: 10px;
            border: none;
            border-radius: 8px;
            width: 300px;
            font-size: 14px;
        }

        .import-button {
            padding: 10px 20px;
            background: #22c55e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .import-button:hover {
            background: #16a34a;
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-button {
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .tab-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .chart-container h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
            font-size: 1.4rem;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        th, td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f8f9ff;
        }

        .status-active {
            color: #22c55e;
            font-weight: bold;
        }

        .status-warning {
            color: #f59e0b;
            font-weight: bold;
        }

        .status-danger {
            color: #ef4444;
            font-weight: bold;
        }

        .record-card {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .record-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .record-list {
            list-style: none;
        }

        .record-list li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }

        .record-list li:last-child {
            border-bottom: none;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .input-group input, .input-group select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .input-group button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .input-group button:hover {
            background: #5a67d8;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            animation: slideIn 0.3s ease;
        }

        .notification.success {
            background: #22c55e;
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.info {
            background: #3b82f6;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .floating-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .floating-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .floating-button:hover {
            transform: scale(1.1);
        }

        .export-btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .refresh-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .search-box {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            width: 250px;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
                align-items: stretch;
            }

            .import-options {
                flex-direction: column;
            }

            .url-input {
                width: 100%;
            }

            .search-box {
                position: relative;
                width: 100%;
                margin-bottom: 20px;
            }

            .floating-controls {
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <input type="text" class="search-box" placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø´Ø§Ø±Ùƒ..." id="searchBox">
    
    <div class="container">
        <div class="header">
            <h1>ğŸ“š Ù†Ø¶Ø§Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡</h1>
            <div class="season-info">
                <h3>Ø§Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ: <span id="currentSeason">Ø´Ù‡Ø± Ù…Ø­Ø±Ù… 1447</span></h3>
                <p>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ <span id="currentWeek">2</span> Ù…Ù† 4 | Ø§Ù„ÙŠÙˆÙ… <span id="currentDay">8</span></p>
                <div class="progress-bar">
                    <div class="progress-fill" id="seasonProgress" style="width: 25%"></div>
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div class="import-section">
            <h3>ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</h3>
            <div class="import-options">
                <div class="file-input-wrapper">
                    <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" onchange="handleFileImport(event)">
                    <label for="excelFile" class="file-input-button">ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù Excel/CSV</label>
                </div>
                
                <input type="text" class="url-input" id="googleSheetsUrl" placeholder="Ø±Ø§Ø¨Ø· Google Sheets...">
                <button class="import-button" onclick="importFromGoogleSheets()">ğŸ“Š Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Google Sheets</button>
                
                <button class="import-button" onclick="loadSampleData()" style="background: #8b5cf6;">ğŸ² ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="showTab('current-results')">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
            <button class="tab-button" onclick="showTab('expulsion-counter')">Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø±Ø¯</button>
            <button class="tab-button" onclick="showTab('expulsion-list')">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø±Ø¯</button>
            <button class="tab-button" onclick="showTab('overall-results')">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</button>
            <button class="tab-button" onclick="showTab('records')">Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ©</button>
            <button class="tab-button" onclick="showTab('data-entry')">Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>

        <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
        <div id="current-results" class="tab-content active">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</h3>
                    <div class="number" id="totalParticipants">0</div>
                </div>
                <div class="stat-card">
                    <h3>Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</h3>
                    <div class="number" id="activeParticipants">0</div>
                </div>
                <div class="stat-card">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙÙƒØ§Ø±</h3>
                    <div class="number" id="totalIdeas">0</div>
                </div>
                <div class="stat-card">
                    <h3>Ù…ØªÙˆØ³Ø· Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
                    <div class="number" id="avgReading">0</div>
                    <small>Ø¯Ù‚ÙŠÙ‚Ø©</small>
                </div>
            </div>

            <div class="chart-container">
                <h3>ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ø­Ø³Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±</h3>
                <div class="chart-wrapper">
                    <canvas id="ideasChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3>Ø£ÙŠØ§Ù… Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©</h3>
                <div class="chart-wrapper">
                    <canvas id="streakChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø±Ø¯ -->
        <div id="expulsion-counter" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 20px;">â° Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø±Ø¯ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
                        <th>Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
                        <th>Ø£ÙŠØ§Ù… Ø¨Ø¯ÙˆÙ† Ù‚Ø±Ø§Ø¡Ø©</th>
                        <th>Ø£ÙŠØ§Ù… Ù…ØªØ¨Ù‚ÙŠØ© Ù„Ù„Ø·Ø±Ø¯</th>
                        <th>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
                    </tr>
                </thead>
                <tbody id="expulsionCounterTable">
                </tbody>
            </table>
        </div>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø±Ø¯ -->
        <div id="expulsion-list" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 20px;">âŒ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø§Ù„Ù…Ø³ØªØ­Ù‚ÙˆÙ† Ù„Ù„Ø·Ø±Ø¯</h2>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
                        <th>Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
                        <th>Ø³Ø¨Ø¨ Ø§Ù„Ø·Ø±Ø¯</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø±Ø¯</th>
                    </tr>
                </thead>
                <tbody id="expulsionListTable">
                </tbody>
            </table>
        </div>

        <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© -->
        <div id="overall-results" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 20px;">ğŸ“ˆ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø³Ù…</h2>
            
            <div class="dashboard-grid">
                <div class="stat-card">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ø³Ù…</h3>
                    <div class="number">3</div>
                </div>
                <div class="stat-card">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</h3>
                    <div class="number" id="totalAllParticipants">0</div>
                </div>
                <div class="stat-card">
                    <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙÙƒØ§Ø±</h3>
                    <div class="number" id="totalAllIdeas">0</div>
                </div>
                <div class="stat-card">
                    <h3>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</h3>
                    <div class="number" id="totalHours">0</div>
                    <small>Ø³Ø§Ø¹Ø©</small>
                </div>
            </div>

            <div class="chart-container">
                <h3>Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ø¹Ø¨Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø³Ù…</h3>
                <div class="chart-wrapper">
                    <canvas id="overallChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© -->
        <div id="records" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 20px;">ğŸ† Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© Ù„Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
            
            <div class="record-card">
                <div class="record-title">ğŸ¥‡ Ø£ÙƒØ«Ø± Ù‚Ø±Ø§Ø¡Ø© ÙÙŠ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯</div>
                <ol class="record-list" id="dailyReadingRecords">
                </ol>
            </div>

            <div class="record-card">
                <div class="record-title">ğŸ”¥ Ø£Ø·ÙˆÙ„ ÙØªØ±Ø© Ù‚Ø±Ø§Ø¡Ø© Ù…ØªØªØ§Ù„ÙŠØ©</div>
                <ol class="record-list" id="streakRecords">
                </ol>
            </div>

            <div class="record-card">
                <div class="record-title">ğŸ’¡ Ø£Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø£ÙÙƒØ§Ø±</div>
                <ol class="record-list" id="ideasRecords">
                </ol>
            </div>
        </div>

        <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div id="data-entry" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 20px;">âœï¸ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©</h2>
            
            <div class="input-group">
                <input type="text" id="participantName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ">
                <input type="number" id="readingMinutes" placeholder="Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©" min="0">
                <input type="date" id="readingDate">
                <button onclick="addReading()">â• Ø¥Ø¶Ø§ÙØ© Ù‚Ø±Ø§Ø¡Ø©</button>
            </div>

            <div class="input-group">
                <select id="participantSelect">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</option>
                </select>
                <select id="activityType">
                    <option value="discussion">Ø¬Ù„Ø³Ø© Ù†Ù‚Ø§Ø´ÙŠØ© (+60 ÙÙƒØ±Ø©)</option>
                    <option value="book-session">Ø¬Ù„Ø³Ø© ÙƒØªØ¨ (+40 ÙÙƒØ±Ø©)</option>
                </select>
                <button onclick="addActivity()">ğŸ¯ Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·</button>
            </div>

            <h3>ğŸ“‹ Ø¢Ø®Ø± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª:</h3>
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
                        <th>Ø§Ù„Ù†Ø´Ø§Ø·</th>
                        <th>Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚/Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    </tr>
                </thead>
                <tbody id="recentEntries">
                </tbody>
            </table>
        </div>
    </div>

    <div class="floating-controls">
        <button class="floating-button export-btn" onclick="exportToExcel()" title="ØªØµØ¯ÙŠØ± Excel">ğŸ“Š</button>
        <button class="floating-button refresh-btn" onclick="refreshData()" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª">ğŸ”„</button>
    </div>

    <script>
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        let participants = [];
        let rawData = [];
        let recentEntries = [];
        let currentCharts = {};
        let searchTerm = '';

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø«
        document.getElementById('searchBox').addEventListener('input', function(e) {
            searchTerm = e.target.value.toLowerCase();
            filterAndUpdateDisplays();
        });

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙˆÙ‚Øª Ù…Ù† Ù†Øµ Ø¥Ù„Ù‰ Ø¯Ù‚Ø§Ø¦Ù‚
        function timeToMinutes(timeStr) {
            if (!timeStr) return 0;
            const parts = timeStr.split(':');
            const hours = parseInt(parts[0]) || 0;
            const minutes = parseInt(parts[1]) || 0;
            const seconds = parseInt(parts[2]) || 0;
            return hours * 60 + minutes + Math.round(seconds / 60);
        }

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙÙƒØ§Ø± Ù…Ø¹ Ø§Ù„Ù…Ø¶Ø§Ø¹ÙØ§Øª
        function calculateIdeas(minutes) {
            let ideas = 0;
            if (minutes <= 15) {
                ideas = minutes;
            } else if (minutes <= 30) {
                ideas = 15 + ((minutes - 15) * 1.15);
            } else {
                ideas = 15 + (15 * 1.15) + ((minutes - 30) * 1.2);
            }
            return Math.round(ideas);
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù„Ù
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù...', 'info');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (file.name.toLowerCase().includes('.csv')) {
                        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù CSV
                        Papa.parse(e.target.result, {
                            header: true,
                            skipEmptyLines: true,
                            complete: function(results) {
                                processImportedData(results.data);
                            }
                        });
                    } else {
                        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ù„Ù Excel
                        const workbook = XLSX.read(e.target.result, {type: 'binary'});
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const data = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                        
                        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ ÙƒØ§Ø¦Ù†Ø§Øª
                        const headers = data[0];
                        const rows = data.slice(1);
                        const jsonData = rows.map(row => {
                            const obj = {};
                            headers.forEach((header, index) => {
                                obj[header] = row[index] || '';
                            });
                            return obj;
                        });
                        
                        processImportedData(jsonData);
                    }
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù:', error);
                    showNotification('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù!', 'error');
                }
            };

            if (file.name.toLowerCase().includes('.csv')) {
                reader.readAsText(file, 'UTF-8');
            } else {
                reader.readAsBinaryString(file);
            }
        }

        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Google Sheets
        async function importFromGoogleSheets() {
            const url = document.getElementById('googleSheetsUrl').value.trim();
            if (!url) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Google Sheets', 'error');
                return;
            }

            showNotification('Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets...', 'info');

            try {
                // ØªØ­ÙˆÙŠÙ„ Ø±Ø§Ø¨Ø· Google Sheets Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· CSV
                let csvUrl = url;
                if (url.includes('/edit')) {
                    csvUrl = url.replace('/edit#gid=', '/export?format=csv&gid=')
                                .replace('/edit?usp=sharing', '/export?format=csv')
                                .replace('/edit', '/export?format=csv');
                }

                const response = await fetch(csvUrl);
                const csvText = await response.text();

                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        processImportedData(results.data);
                    },
                    error: function(error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets', 'error');
                    }
                });

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Sheets', 'error');
            }
        }

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©
        function processImportedData(data) {
            rawData = data;
            participants = [];
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ
            const participantMap = new Map();

            data.forEach(row => {
                // Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const email = (row.Email || row['Email address'] || '').toLowerCase().trim();
                const name = (row['Ø§Ù„Ø§Ø³Ù…'] || row.Name || email.split('@')[0] || '').trim();
                const timeStr = row['Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ù†Ø¬Ø²Ø© ğŸ’¡'] || row.Time || row.Minutes || '0:00:00';
                const additionalIdeas = parseInt(row['Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©'] || row['Additional Points'] || 0);
                const dateStr = row['ØªØ§Ø±ÙŠØ®'] || row.Date || row.Timestamp || '';
                
                if (!name || !email) return;

                const minutes = timeToMinutes(timeStr);
                const ideas = calculateIdeas(minutes) + additionalIdeas;
                
                if (!participantMap.has(email)) {
                    participantMap.set(email, {
                        name: name,
                        email: email,
                        totalIdeas: 0,
                        totalMinutes: 0,
                        streak: 0,
                        lastReadingDate: null,
                        dailyReadings: [],
                        status: 'Ù†Ø´Ø·'
                    });
                }

                const participant = participantMap.get(email);
                participant.totalIdeas += ideas;
                participant.totalMinutes += minutes;
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                if (minutes > 0) {
                    participant.dailyReadings.push({
                        date: dateStr,
                        minutes: minutes,
                        ideas: ideas
                    });
                }
            });

            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ© ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            participants = Array.from(participantMap.values());
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ© ÙˆØ§Ù„Ø­Ø§Ù„Ø©
            participants.forEach(participant => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ© (ØªÙ‚Ø¯ÙŠØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø§Øª)
                participant.streak = Math.min(participant.dailyReadings.length, 21);
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø§Ù„Ø©
                if (participant.totalIdeas <= 0) {
                    participant.status = 'Ù…Ø·Ø±ÙˆØ¯';
                } else if (participant.totalIdeas < 50) {
                    participant.status = 'Ø®Ø·Ø±';
                } else if (participant.totalIdeas < 100) {
                    participant.status = 'ØªØ­Ø°ÙŠØ±';
                } else {
                    participant.status = 'Ù†Ø´Ø·';
                }
            });

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø­Ø§ÙƒØ§Ø©
            applyDailyDeductionSimulation();
            
            updateAllDisplays();
            showNotification(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ${participants.length} Ù…Ø´Ø§Ø±Ùƒ Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        function loadSampleData() {
            const sampleData = [
                { name: "Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯", email: "ahmed@example.com", totalIdeas: 2340, totalMinutes: 2100, streak: 21, status: "Ù†Ø´Ø·" },
                { name: "Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯", email: "sara@example.com", totalIdeas: 2180, totalMinutes: 1950, streak: 19, status: "Ù†Ø´Ø·" },
                { name: "Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ", email: "mohammed@example.com", totalIdeas: 1950, totalMinutes: 1800, streak: 17, status: "Ù†Ø´Ø·" },
                { name: "ÙØ§Ø·Ù…Ø© Ø­Ø³Ù†", email: "fatima@example.com", totalIdeas: 1820, totalMinutes: 1650, streak: 15, status: "Ù†Ø´Ø·" },
                { name: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø³Ø§Ù„Ù…", email: "abdullah@example.com", totalIdeas: 1650, totalMinutes: 1500, streak: 13, status: "Ù†Ø´Ø·" },
                { name: "Ù†ÙˆØ±Ø§ Ø®Ø§Ù„Ø¯", email: "nora@example.com", totalIdeas: 1480, totalMinutes: 1350, streak: 11, status: "Ù†Ø´Ø·" },
                { name: "ÙŠÙˆØ³Ù Ø£Ø­Ù…Ø¯", email: "youssef@example.com", totalIdeas: 1320, totalMinutes: 1200, streak: 9, status: "Ù†Ø´Ø·" },
                { name: "Ù…Ø±ÙŠÙ… Ù…Ø­Ù…Ø¯", email: "mariam@example.com", totalIdeas: 1150, totalMinutes: 1050, streak: 7, status: "Ù†Ø´Ø·" },
                { name: "Ø®Ø§Ù„Ø¯ Ø¹Ù„ÙŠ", email: "khalid@example.com", totalIdeas: 980, totalMinutes: 900, streak: 5, status: "Ù†Ø´Ø·" },
                { name: "Ù‡Ù†Ø¯ Ø³Ø§Ù„Ù…", email: "hind@example.com", totalIdeas: 850, totalMinutes: 750, streak: 3, status: "Ù†Ø´Ø·" },
                { name: "Ø¹Ù…Ø± Ø­Ø³Ù†", email: "omar@example.com", totalIdeas: 45, totalMinutes: 45, streak: 1, status: "ØªØ­Ø°ÙŠØ±" },
                { name: "Ù„ÙŠÙ„Ù‰ Ù…Ø­Ù…ÙˆØ¯", email: "layla@example.com", totalIdeas: 25, totalMinutes: 25, streak: 0, status: "Ø®Ø·Ø±" },
                { name: "Ø­Ø³Ø§Ù… Ø£Ø­Ù…Ø¯", email: "hussam@example.com", totalIdeas: 15, totalMinutes: 15, streak: 0, status: "Ø®Ø·Ø±" },
                { name: "Ø±Ø§Ù†ÙŠØ§ Ø¹Ù„ÙŠ", email: "rania@example.com", totalIdeas: 8, totalMinutes: 8, streak: 0, status: "Ø®Ø·Ø±" },
                { name: "Ø·Ø§Ø±Ù‚ Ø³Ø¹Ø¯", email: "tarek@example.com", totalIdeas: 0, totalMinutes: 0, streak: 0, status: "Ù…Ø·Ø±ÙˆØ¯" }
            ];

            participants = sampleData.map(p => ({
                ...p,
                dailyReadings: Array.from({length: p.streak}, (_, i) => ({
                    date: new Date(Date.now() - (i * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
                    minutes: Math.random() * 60 + 15,
                    ideas: Math.random() * 70 + 15
                }))
            }));

            updateAllDisplays();
            showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø®ØµÙ… Ø§Ù„ÙŠÙˆÙ…ÙŠ
        function applyDailyDeductionSimulation() {
            const currentWeek = getCurrentWeek();
            if (currentWeek > 1) {
                participants.forEach(participant => {
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ø®ØµÙ… Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†
                    if (Math.random() < 0.3 && participant.totalIdeas > 0) {
                        const daysWithoutReading = Math.floor(Math.random() * 5);
                        participant.totalIdeas = Math.max(0, participant.totalIdeas - (daysWithoutReading * 10));
                        participant.streak = Math.max(0, participant.streak - daysWithoutReading);
                    }
                });
            }
        }

        // ØªØµÙÙŠØ© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±ÙˆØ¶
        function filterAndUpdateDisplays() {
            const filteredParticipants = participants.filter(p => 
                !searchTerm || p.name.toLowerCase().includes(searchTerm) || p.email.toLowerCase().includes(searchTerm)
            );
            
            updateChartsWithData(filteredParticipants);
            updateTablesWithData(filteredParticipants);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ø±ÙˆØ¶
        function updateAllDisplays() {
            updateStatistics();
            updateParticipantSelect();
            updateExpulsionCounter();
            updateExpulsionList();
            updateRecords();
            initializeRecentEntries();
            
            setTimeout(() => {
                createIdeasChart();
                createStreakChart();
                createOverallChart();
            }, 100);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            setTimeout(() => {
                if (tabName === 'current-results') {
                    createIdeasChart();
                    createStreakChart();
                } else if (tabName === 'overall-results') {
                    createOverallChart();
                } else if (tabName === 'expulsion-counter') {
                    updateExpulsionCounter();
                } else if (tabName === 'expulsion-list') {
                    updateExpulsionList();
                } else if (tabName === 'records') {
                    updateRecords();
                }
            }, 100);
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø£ÙÙƒØ§Ø±
        function createIdeasChart() {
            const ctx = document.getElementById('ideasChart');
            if (!ctx) return;

            if (currentCharts.ideas) {
                currentCharts.ideas.destroy();
            }

            const filteredData = participants.filter(p => 
                !searchTerm || p.name.toLowerCase().includes(searchTerm)
            );
            
            const sortedByIdeas = [...filteredData].sort((a, b) => b.totalIdeas - a.totalIdeas).slice(0, 15);
            
            currentCharts.ideas = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedByIdeas.map(p => p.name),
                    datasets: [{
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±',
                        data: sortedByIdeas.map(p => p.totalIdeas),
                        backgroundColor: sortedByIdeas.map((_, i) => 
                            `hsla(${240 + i * 10}, 70%, 60%, 0.8)`
                        ),
                        borderColor: sortedByIdeas.map((_, i) => 
                            `hsla(${240 + i * 10}, 70%, 50%, 1)`
                        ),
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Ø§Ù„Ø£ÙÙƒØ§Ø±: ${context.parsed.x.toLocaleString()}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.1)' }
                        },
                        y: { grid: { display: false } }
                    }
                }
            });
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©
        function createStreakChart() {
            const ctx = document.getElementById('streakChart');
            if (!ctx) return;

            if (currentCharts.streak) {
                currentCharts.streak.destroy();
            }

            const filteredData = participants.filter(p => 
                !searchTerm || p.name.toLowerCase().includes(searchTerm)
            );
            
            const sortedByStreak = [...filteredData].sort((a, b) => b.streak - a.streak).slice(0, 15);
            
            currentCharts.streak = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedByStreak.map(p => p.name),
                    datasets: [{
                        label: 'Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©',
                        data: sortedByStreak.map(p => p.streak),
                        backgroundColor: sortedByStreak.map((_, i) => 
                            `hsla(${280 + i * 8}, 70%, 60%, 0.8)`
                        ),
                        borderColor: sortedByStreak.map((_, i) => 
                            `hsla(${280 + i * 8}, 70%, 50%, 1)`
                        ),
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©: ${context.parsed.x}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.1)' }
                        },
                        y: { grid: { display: false } }
                    }
                }
            });
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        function createOverallChart() {
            const ctx = document.getElementById('overallChart');
            if (!ctx) return;

            if (currentCharts.overall) {
                currentCharts.overall.destroy();
            }

            currentCharts.overall = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Ø§Ù„Ù…ÙˆØ³Ù… 1', 'Ø§Ù„Ù…ÙˆØ³Ù… 2', 'Ø§Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ'],
                    datasets: [{
                        label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙÙƒØ§Ø±',
                        data: [4500, 5200, participants.reduce((sum, p) => sum + p.totalIdeas, 0)],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†',
                        data: [15, 18, participants.length],
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Ø§Ù„Ø£ÙÙƒØ§Ø±' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStatistics() {
            const totalParticipants = participants.length;
            const activeParticipants = participants.filter(p => p.status !== 'Ù…Ø·Ø±ÙˆØ¯').length;
            const totalIdeas = participants.reduce((sum, p) => sum + p.totalIdeas, 0);
            const totalMinutes = participants.reduce((sum, p) => sum + p.totalMinutes, 0);
            const avgReading = activeParticipants > 0 ? Math.round(totalMinutes / activeParticipants / getCurrentDay()) : 0;

            document.getElementById('totalParticipants').textContent = totalParticipants;
            document.getElementById('activeParticipants').textContent = activeParticipants;
            document.getElementById('totalIdeas').textContent = totalIdeas.toLocaleString();
            document.getElementById('avgReading').textContent = avgReading;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©
            document.getElementById('totalAllParticipants').textContent = totalParticipants;
            document.getElementById('totalAllIdeas').textContent = totalIdeas.toLocaleString();
            document.getElementById('totalHours').textContent = Math.round(totalMinutes / 60);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø·Ø±Ø¯
        function updateExpulsionCounter() {
            const tbody = document.getElementById('expulsionCounterTable');
            tbody.innerHTML = '';

            const filteredParticipants = participants.filter(p => 
                p.status !== 'Ù…Ø·Ø±ÙˆØ¯' && (!searchTerm || p.name.toLowerCase().includes(searchTerm))
            );

            filteredParticipants.forEach(participant => {
                const daysWithoutReading = Math.max(0, 7 - participant.streak);
                const daysToExpulsion = participant.totalIdeas > 0 ? Math.ceil(participant.totalIdeas / 10) : 0;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${participant.name}</td>
                    <td>${participant.totalIdeas}</td>
                    <td>${daysWithoutReading}</td>
                    <td>${daysToExpulsion}</td>
                    <td class="${getStatusClass(participant.status)}">${participant.status}</td>
                `;
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø±Ø¯
        function updateExpulsionList() {
            const tbody = document.getElementById('expulsionListTable');
            tbody.innerHTML = '';

            const toBeExpelled = participants.filter(p => {
                const shouldBeExpelled = p.status === 'Ù…Ø·Ø±ÙˆØ¯' || 
                    p.totalIdeas <= 0 || 
                    (getCurrentWeek() >= 3 && p.totalIdeas < 100);
                
                return shouldBeExpelled && (!searchTerm || p.name.toLowerCase().includes(searchTerm));
            });

            toBeExpelled.forEach(participant => {
                let reason = '';
                if (participant.totalIdeas <= 0) {
                    reason = 'ÙˆØµÙˆÙ„ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø¥Ù„Ù‰ ØµÙØ±';
                } else if (getCurrentWeek() >= 3 && participant.totalIdeas < 100) {
                    reason = 'Ø¹Ø¯Ù… ØªØ­Ù‚ÙŠÙ‚ 100 ÙÙƒØ±Ø© Ø¨Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø«';
                } else {
                    reason = 'ØªÙ… Ø·Ø±Ø¯Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹';
                }

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${participant.name}</td>
                    <td>${participant.totalIdeas}</td>
                    <td>${reason}</td>
                    <td>${new Date().toLocaleDateString('ar-SA')}</td>
                `;
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ©
        function updateRecords() {
            // Ø£ÙƒØ«Ø± Ù‚Ø±Ø§Ø¡Ø© ÙÙŠ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯
            const dailyRecords = participants
                .filter(p => p.dailyReadings && p.dailyReadings.length > 0)
                .map(p => ({
                    name: p.name,
                    maxDaily: Math.max(...p.dailyReadings.map(r => r.minutes))
                }))
                .sort((a, b) => b.maxDaily - a.maxDaily)
                .slice(0, 3);

            const dailyList = document.getElementById('dailyReadingRecords');
            dailyList.innerHTML = dailyRecords.map(r => 
                `<li>${r.name} - ${r.maxDaily} Ø¯Ù‚ÙŠÙ‚Ø©</li>`
            ).join('');

            // Ø£Ø·ÙˆÙ„ ÙØªØ±Ø© Ù‚Ø±Ø§Ø¡Ø© Ù…ØªØªØ§Ù„ÙŠØ©
            const streakRecords = participants
                .sort((a, b) => b.streak - a.streak)
                .slice(0, 3);

            const streakList = document.getElementById('streakRecords');
            streakList.innerHTML = streakRecords.map(r => 
                `<li>${r.name} - ${r.streak} ÙŠÙˆÙ…</li>`
            ).join('');

            // Ø£Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø£ÙÙƒØ§Ø±
            const ideasRecords = participants
                .sort((a, b) => b.totalIdeas - a.totalIdeas)
                .slice(0, 3);

            const ideasList = document.getElementById('ideasRecords');
            ideasList.innerHTML = ideasRecords.map(r => 
                `<li>${r.name} - ${r.totalIdeas.toLocaleString()} ÙÙƒØ±Ø©</li>`
            ).join('');
        }

        // Ø¥Ø¶Ø§ÙØ© Ù‚Ø±Ø§Ø¡Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function addReading() {
            const name = document.getElementById('participantName').value.trim();
            const minutes = parseInt(document.getElementById('readingMinutes').value);
            const date = document.getElementById('readingDate').value;

            if (!name || !minutes || !date) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }

            const ideas = calculateIdeas(minutes);

            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø´Ø§Ø±Ùƒ Ø¬Ø¯ÙŠØ¯
            let participant = participants.find(p => p.name === name);
            if (participant) {
                participant.totalIdeas += ideas;
                participant.totalMinutes += minutes;
                participant.streak += 1;
                participant.status = participant.totalIdeas > 100 ? 'Ù†Ø´Ø·' : 'ØªØ­Ø°ÙŠØ±';
            } else {
                participants.push({
                    name: name,
                    email: `${name.replace(/\s+/g, '')}@temp.com`,
                    totalIdeas: ideas,
                    totalMinutes: minutes,
                    streak: 1,
                    dailyReadings: [],
                    status: ideas > 100 ? 'Ù†Ø´Ø·' : 'ØªØ­Ø°ÙŠØ±'
                });
            }

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù„Ø³Ø¬Ù„
            recentEntries.unshift({
                participant: name,
                activity: 'Ù‚Ø±Ø§Ø¡Ø©',
                value: `${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`,
                ideas: ideas,
                date: date
            });

            if (recentEntries.length > 50) {
                recentEntries = recentEntries.slice(0, 50);
            }

            updateAllDisplays();
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('participantName').value = '';
            document.getElementById('readingMinutes').value = '';

            showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${ideas} ÙÙƒØ±Ø© Ù„Ù„Ù…Ø´Ø§Ø±Ùƒ ${name}`, 'success');
        }

        // Ø¥Ø¶Ø§ÙØ© Ù†Ø´Ø§Ø·
        function addActivity() {
            const participantName = document.getElementById('participantSelect').value;
            const activityType = document.getElementById('activityType').value;

            if (!participantName || !activityType) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·', 'error');
                return;
            }

            let ideasToAdd = 0;
            let activityName = '';
            
            switch (activityType) {
                case 'discussion':
                    ideasToAdd = 60;
                    activityName = 'Ø¬Ù„Ø³Ø© Ù†Ù‚Ø§Ø´ÙŠØ©';
                    break;
                case 'book-session':
                    ideasToAdd = 40;
                    activityName = 'Ø¬Ù„Ø³Ø© ÙƒØªØ¨';
                    break;
            }

            const participant = participants.find(p => p.name === participantName);
            if (participant) {
                participant.totalIdeas += ideasToAdd;
                participant.status = participant.totalIdeas > 100 ? 'Ù†Ø´Ø·' : 'ØªØ­Ø°ÙŠØ±';
            }

            recentEntries.unshift({
                participant: participantName,
                activity: activityName,
                value: `+${ideasToAdd} ÙÙƒØ±Ø©`,
                ideas: ideasToAdd,
                date: new Date().toLocaleDateString('ar-SA')
            });

            if (recentEntries.length > 50) {
                recentEntries = recentEntries.slice(0, 50);
            }

            updateAllDisplays();
            showNotification(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${ideasToAdd} ÙÙƒØ±Ø© Ù„Ù„Ù…Ø´Ø§Ø±Ùƒ ${participantName} Ù…Ù† ${activityName}`, 'success');
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† ÙÙŠ Ø§Ù„Ù€ select
        function updateParticipantSelect() {
            const select = document.getElementById('participantSelect');
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</option>';
            
            participants.forEach(participant => {
                const option = document.createElement('option');
                option.value = participant.name;
                option.textContent = participant.name;
                select.appendChild(option);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©
        function updateRecentEntries() {
            const tbody = document.getElementById('recentEntries');
            tbody.innerHTML = '';

            recentEntries.slice(0, 15).forEach(entry => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${entry.participant}</td>
                    <td>${entry.activity}</td>
                    <td>${entry.value}</td>
                    <td>${entry.ideas}</td>
                    <td>${entry.date}</td>
                `;
            });
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©
        function initializeRecentEntries() {
            if (recentEntries.length === 0) {
                recentEntries = [
                    { participant: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯', activity: 'Ù‚Ø±Ø§Ø¡Ø©', value: '45 Ø¯Ù‚ÙŠÙ‚Ø©', ideas: 48, date: new Date().toLocaleDateString('ar-SA') },
                    { participant: 'Ø³Ø§Ø±Ø© Ø£Ø­Ù…Ø¯', activity: 'Ø¬Ù„Ø³Ø© Ù†Ù‚Ø§Ø´ÙŠØ©', value: '+60 ÙÙƒØ±Ø©', ideas: 60, date: new Date().toLocaleDateString('ar-SA') }
                ];
            }
            updateRecentEntries();
        }

        // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
        function exportToExcel() {
            const ws_data = [
                ['Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ', 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±', 'Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©', 'Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØªØ§Ù„ÙŠØ©', 'Ø§Ù„Ø­Ø§Ù„Ø©']
            ];

            participants.forEach(p => {
                ws_data.push([
                    p.name,
                    p.email,
                    p.totalIdeas,
                    p.totalMinutes,
                    p.streak,
                    p.status
                ]);
            });

            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©');

            const fileName = `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©_${new Date().toLocaleDateString('ar-SA').replace(/\//g, '-')}.xlsx`;
            XLSX.writeFile(wb, fileName);

            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function refreshData() {
            showNotification('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            applyDailyDeductionSimulation();
            updateAllDisplays();
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙØ¦Ø© Ø§Ù„Ø­Ø§Ù„Ø©
        function getStatusClass(status) {
            switch (status) {
                case 'Ù†Ø´Ø·': return 'status-active';
                case 'ØªØ­Ø°ÙŠØ±': return 'status-warning';
                case 'Ø®Ø·Ø±': case 'Ù…Ø·Ø±ÙˆØ¯': return 'status-danger';
                default: return '';
            }
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        function getCurrentWeek() {
            return parseInt(document.getElementById('currentWeek').textContent);
        }

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
        function getCurrentDay() {
            return parseInt(document.getElementById('currentDay').textContent);
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('readingDate').value = new Date().toISOString().split('T')[0];
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ÙƒØ¨Ø¯Ø§ÙŠØ©
            loadSampleData();
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            const currentDay = getCurrentDay();
            const currentWeek = getCurrentWeek();
            const totalDays = 28; // 4 Ø£Ø³Ø§Ø¨ÙŠØ¹
            const daysPassed = (currentWeek - 1) * 7 + currentDay;
            const progress = (daysPassed / totalDays) * 100;
            document.getElementById('seasonProgress').style.width = `${progress}%`;
        });
    </script>
</body>
</html>
